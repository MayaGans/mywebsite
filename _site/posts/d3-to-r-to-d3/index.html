<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maya Gans">
<meta name="dcterms.date" content="2021-08-30">
<meta name="description" content="Documenting using D3 in R (without Observable)">

<title>Maya Gans</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="../../site_libs/r2d3-render-0.1.0/r2d3-render.js"></script>
<script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
<script src="../../site_libs/r2d3-binding-0.2.5/r2d3.js"></script>
<script src="../../site_libs/d3v6-6.2.0/d3.min.js"></script>


<link rel="stylesheet" href="../../inst/css/styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">maya<br>gans</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dataviz.html">dataviz</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html">projects</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html">resume</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">D3 to R to D3</h1>
                  <div>
        <div class="description">
          Documenting using D3 in R (without Observable)
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">JavaScript</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Maya Gans </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 30, 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#our-plot" id="toc-our-plot" class="nav-link active" data-scroll-target="#our-plot">Our Plot</a></li>
  <li><a href="#step-1-import-the-data" id="toc-step-1-import-the-data" class="nav-link" data-scroll-target="#step-1-import-the-data">Step 1: Import the Data</a></li>
  <li><a href="#step-2-create-the-chart" id="toc-step-2-create-the-chart" class="nav-link" data-scroll-target="#step-2-create-the-chart">Step 2 Create the Chart</a></li>
  <li><a href="#step-3-draw-a-canvass" id="toc-step-3-draw-a-canvass" class="nav-link" data-scroll-target="#step-3-draw-a-canvass">Step 3 Draw a Canvass</a></li>
  <li><a href="#step-4-create-scales" id="toc-step-4-create-scales" class="nav-link" data-scroll-target="#step-4-create-scales">Step 4 Create Scales</a></li>
  <li><a href="#step-5-draw-data" id="toc-step-5-draw-data" class="nav-link" data-scroll-target="#step-5-draw-data">Step 5 Draw Data</a></li>
  <li><a href="#step-6-draw-peripherals" id="toc-step-6-draw-peripherals" class="nav-link" data-scroll-target="#step-6-draw-peripherals">Step 6 Draw Peripherals</a></li>
  <li><a href="#put-it-together-in-r2d3" id="toc-put-it-together-in-r2d3" class="nav-link" data-scroll-target="#put-it-together-in-r2d3">Put it together in R2D3</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>I can’t tell you how many times I’ve tried to “learn” d3.js. I end up making it <em>maybe</em> a third of the way through a book before giving up and just looking through <a href="https://bl.ocks.org/">bl.ocks</a> or <a href="https://observablehq.com/">Observable Notebooks</a> because I want to make a plot <em>now</em>, not once I’ve read a text book.</p>
<p>I’m writing this blog post because I am absolutely in LOVE with <a href="https://www.amazon.com/Fullstack-Data-Visualization-beautiful-visualizations/dp/0991344650">Amelia Wattenberger’s Fullstack Data Visualization with D3</a>. I’m one chapter in and we already made a plot!</p>
<p>Amelia breaks down chart creation into 7 parts:</p>
<ol type="1">
<li>Access data</li>
<li>Create chart</li>
<li>Draw canvas</li>
<li>Create scales</li>
<li>Draw data</li>
<li>Draw peripherals . Set up interactions [not in this chapter]</li>
</ol>
<p>This is interesting to contrast with R where we have step 1, and make the call to the function <code>ggplot2</code> for step 2, but then can fastworward straight to step 5, and let ggplot figure out steps 3,4, and 6 for us!</p>
<p><code>d3.js</code> requires us to create the entire universe our plot lives in, and the axes for the plot seperately. You need to answer questions like how big is the area for your plot + axes and legend (peripherals) and then how do you want to scale your data to the pixel size of that plot since it wont be 1 to 1!</p>
<section id="our-plot" class="level2">
<h2 class="anchored" data-anchor-id="our-plot">Our Plot</h2>
<p>The plot in Chapter 1 is a line chart of weather data, with a shaded area to denote temperatures below freezing. One of the ways (maybe the only?) <code>D3</code> is similar to <code>ggplot2</code> is that once you have the code it’s pretty easy to just drop in different <code>data</code>, <code>x</code>, and <code>y</code> values.</p>
<p>For that reason, rather than just copy the book, I wanted to make the plot my own - which means Phish data and using the package <code>{ R2D3 }</code>.</p>
<p>I’m going to plot the song length of every time the band Phish played the song “Tweezer” live, and my shaded area will be around the mean.</p>
</section>
<section id="step-1-import-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-import-the-data">Step 1: Import the Data</h2>
<p><code>d3.js</code> expects a JSON object as the data input, but the <code>R2D3</code> package lets us use data in our comfort zone! The <code>R2D3</code> function takes on two main arguments: the data, and a <code>javascript</code> file containing our <code>d3</code> code. That’s one less new step we need to learn!</p>
<p>We can use the <code>phish.in</code> API wrapper I created to grab the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  tweezer <span class="ot">&lt;-</span> phishr<span class="sc">::</span><span class="fu">pi_get_songs</span>(key, <span class="st">"Tweezer"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, duration)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…But now we’re going to have to head over into JavaScript world and create <code>tweezer.js</code> for steps 2-6.</p>
</section>
<section id="step-2-create-the-chart" class="level2">
<h2 class="anchored" data-anchor-id="step-2-create-the-chart">Step 2 Create the Chart</h2>
<p>I’m not going to re-explain the concepts in the book, you should read the book for that! I only want to talk about the differences in the code when translating it from the book to R.</p>
<p>I had to change the width of the plot to a static number because the book sets the width of the plot based on the browser and I’m not entirely sure how R2D3 works but this was problematic…</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> dimensions <span class="op">=</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">margin</span><span class="op">:</span> {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   <span class="dt">top</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">right</span><span class="op">:</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">bottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="dt">left</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3-draw-a-canvass" class="level2">
<h2 class="anchored" data-anchor-id="step-3-draw-a-canvass">Step 3 Draw a Canvass</h2>
<p>The biggest change in the code is that in the book we bind the visualization to a <code>&lt;div&gt;</code> called wrapper then append an <code>svg</code> but it seems that R2D3 takes care of this part for us and makes available an object called <code>svg</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> wrapper <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"#wrapper"</span>) </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dimensions<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dimensions<span class="op">.</span><span class="at">height</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Becomes</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// svg just exists for us! </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> wrapper <span class="op">=</span> svg</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dimensions<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dimensions<span class="op">.</span><span class="at">height</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I’d like to dig into my mental model a bit deeper for this but I think the magic of R2D3 is that instead of a <code>div</code> called wrapper markdown automatically creates an output div with an id, and R2D3 “knows” to bind the svg object to that created <code>div</code>… I think?</p>
</section>
<section id="step-4-create-scales" class="level2">
<h2 class="anchored" data-anchor-id="step-4-create-scales">Step 4 Create Scales</h2>
<p>The code doesn’t change here but I wanted to plot my shaded area around the mean song length, rather than a box that starts at zero so I changed the code a little. If you don’t change this code you’ll still get the box from <code>0</code> to <code>32</code> on the y-axis.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> meanSongPlacement <span class="op">=</span> <span class="fu">yScale</span>(d3<span class="op">.</span><span class="fu">mean</span>(data<span class="op">,</span> yAccessor))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>meanSong <span class="op">=</span> bounds<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dimensions<span class="op">.</span><span class="at">boundedWidth</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// we want the line to start 10 above the mean</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> meanSongPlacement <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// placeholder and end 10 below</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#e0f3f3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-draw-data" class="level2">
<h2 class="anchored" data-anchor-id="step-5-draw-data">Step 5 Draw Data</h2>
<p>The only change here is that R2D3 expects our data to be called <code>data</code> and in the book it was <code>dataset</code></p>
</section>
<section id="step-6-draw-peripherals" class="level2">
<h2 class="anchored" data-anchor-id="step-6-draw-peripherals">Step 6 Draw Peripherals</h2>
<p>In the book we moved the x-axis to the bottom of the svg using the <code>style</code> call. But this does not work in R2D3</p>
<p><a href="https://twitter.com/NicholasStrayer">Nick Strayer</a> proposed this could be due to</p>
<blockquote class="blockquote">
<p>css-based transforms of svg elements are either new enough to not work in the web-view of RStudio or they dont’ work in virtual dom like r2d3 uses.</p>
</blockquote>
<p>So I changed the call from <code>.style</code> to <code>.attr</code> and it worked!</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">style</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translateY(</span><span class="sc">${</span> dimensions<span class="op">.</span><span class="at">boundedHeight</span><span class="sc">}</span><span class="vs"> px)`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Becomes</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>dimensions<span class="op">.</span><span class="at">boundedHeight</span><span class="sc">}</span><span class="vs">)`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="put-it-together-in-r2d3" class="level2">
<h2 class="anchored" data-anchor-id="put-it-together-in-r2d3">Put it together in R2D3</h2>
<p>You can find the JS code all together in my <a href="https://github.com/MayaGans/BayesianBabe/blob/master/content/post/2020-08-27-d3-to-r-to-d3/tweezer.js">repo here</a> but now all we need to do is specify our data and our js file!</p>
<p><strong>I added an argument to the <code>options</code> so my plot has the background color of my blog instead of a default white background</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>r2d3<span class="sc">::</span><span class="fu">r2d3</span>(<span class="at">data =</span> tweezer, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"tweezer.js"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">options =</span> <span class="fu">list</span>(<span class="st">"background"</span>, <span class="st">"#fadadd"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-c923df14f9dcc9e09cd8" style="width:100%;height:464px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-c923df14f9dcc9e09cd8">{"x":{"data":{"date":["2022-08-06","2022-07-31","2022-07-31","2022-07-19","2022-07-19","2022-07-19","2022-07-19","2022-05-29","2022-04-21","2022-04-21","2022-02-24","2021-10-29","2021-10-29","2021-10-24","2021-10-24","2021-09-01","2021-08-13","2021-08-01","2020-02-22","2019-12-30","2019-12-30","2019-12-03","2019-12-03","2019-12-03","2019-12-03","2019-09-01","2019-07-12","2019-06-30","2019-06-21","2019-06-21","2019-06-21","2019-02-23","2018-12-29","2018-12-29","2018-10-31","2018-10-26","2018-10-20","2018-09-02","2018-08-12","2018-08-03","2018-07-21","2017-12-30","2017-07-21","2017-01-15","2016-12-30","2016-10-29","2016-10-19","2016-09-02","2016-08-28","2016-07-15","2016-07-06","2016-06-25","2016-01-02","2015-09-06","2015-08-22","2015-08-15","2015-08-15","2015-08-09","2015-08-07","2015-08-01","2015-07-25","2014-12-31","2014-10-31","2014-10-25","2014-10-21","2014-08-31","2014-08-01","2014-07-27","2014-07-27","2014-07-27","2014-07-27","2014-07-27","2014-07-16","2014-07-13","2014-07-08","2014-07-03","2013-12-28","2013-11-02","2013-10-27","2013-10-20","2013-08-31","2013-07-31","2013-07-22","2013-07-16","2013-07-12","2013-07-06","2012-12-28","2012-09-01","2012-08-26","2012-08-22","2012-08-17","2012-07-04","2012-06-28","2012-06-24","2012-06-20","2012-06-10","2011-12-28","2011-09-03","2011-08-17","2011-08-12","2011-08-06","2011-08-06","2011-07-02","2011-06-15","2011-06-11","2011-06-05","2011-06-01","2011-05-27","2010-12-30","2010-10-30","2010-10-23","2010-10-16","2010-10-11","2010-08-18","2010-08-15","2010-08-09","2010-08-05","2010-07-03","2010-06-26","2010-06-18","2010-06-13","2009-12-29","2009-12-05","2009-12-02","2009-11-25","2009-11-20","2009-11-01","2009-08-15","2009-08-08","2009-07-31","2009-06-19","2009-06-14","2009-06-07","2009-05-31","2009-03-06","2004-08-11","2004-06-21","2004-06-18","2004-04-17","2003-12-28","2003-12-01","2003-07-26","2003-07-21","2003-07-17","2003-07-12","2003-07-08","2003-02-28","2003-02-20","2003-01-03","2000-10-07","2000-09-25","2000-09-23","2000-07-08","2000-06-30","2000-06-24","2000-06-09","1999-12-30","1999-12-16","1999-12-10","1999-12-04","1999-10-08","1999-10-02","1999-09-28","1999-09-18","1999-09-09","1999-08-01","1999-07-24","1999-07-17","1999-07-10","1998-12-31","1998-11-28","1998-11-24","1998-11-14","1998-10-30","1998-08-15","1998-08-01","1998-07-25","1998-07-19","1998-07-15","1998-07-09","1998-07-01","1998-04-04","1997-12-31","1997-12-12","1997-12-06","1997-11-26","1997-11-22","1997-11-17","1997-08-17","1997-08-02","1997-02-20","1997-02-16","1996-12-30","1996-12-01","1996-11-27","1996-11-18","1996-11-11","1996-11-03","1996-10-27","1996-10-23","1996-10-17","1996-08-17","1996-08-14","1996-08-06","1996-08-02","1996-07-21","1996-07-12","1996-07-07","1995-12-28","1995-12-17","1995-12-14","1995-12-14","1995-12-08","1995-12-02","1995-11-30","1995-11-19","1995-11-12","1995-10-22","1995-10-15","1995-10-06","1995-09-28","1995-07-02","1995-06-28","1995-06-22","1995-06-17","1995-06-17","1995-06-14","1995-06-08","1994-12-30","1994-12-09","1994-12-04","1994-12-01","1994-12-01","1994-11-28","1994-11-23","1994-11-18","1994-11-13","1994-11-02","1994-10-27","1994-10-22","1994-10-14","1994-10-10","1994-10-07","1994-07-13","1994-07-13","1994-07-13","1994-07-09","1994-07-06","1994-07-02","1994-06-29","1994-06-23","1994-06-18","1994-06-10","1994-05-28","1994-05-25","1994-05-22","1994-05-17","1994-05-07","1994-05-04","1994-04-22","1994-04-16","1994-04-05","1993-12-31","1993-08-15","1993-08-12","1993-08-12","1993-08-09","1993-08-06","1993-07-30","1993-07-25","1993-07-22","1993-07-17","1993-05-06","1993-05-03","1993-04-30","1993-04-25","1993-04-22","1993-04-18","1993-04-14","1993-04-12","1993-04-05","1993-04-01","1993-03-30","1993-03-26","1993-03-24","1993-03-21","1993-03-16","1993-03-13","1993-03-09","1993-03-06","1993-03-02","1993-02-26","1993-02-22","1993-02-20","1993-02-20","1993-02-18","1993-02-13","1993-02-10","1993-02-07","1993-02-05","1993-02-03","1992-12-29","1992-12-12","1992-12-10","1992-12-05","1992-12-02","1992-11-28","1992-11-25","1992-11-22","1992-11-22","1992-11-19","1992-08-17","1992-07-24","1992-07-14","1992-05-16","1992-05-09","1992-05-07","1992-05-03","1992-04-30","1992-04-23","1992-04-21","1992-04-17","1992-04-07","1992-04-01","1992-03-30","1992-03-25","1992-03-17","1992-03-12","1992-03-07","1991-12-31","1991-12-05","1991-11-23","1991-11-21","1991-11-14","1991-11-09","1991-11-01","1991-10-19","1991-10-12","1991-10-03","1991-09-30","1991-09-27","1991-08-03","1991-07-26","1991-07-23","1991-07-21","1991-07-19","1991-07-12","1991-05-11","1991-05-03","1991-04-27","1991-04-22","1991-04-20","1991-04-16","1991-04-13","1991-04-11","1991-04-06","1991-04-03","1991-03-29","1991-03-23","1991-03-17","1991-03-13","1991-03-08","1991-03-01","1991-02-20","1991-02-09","1991-02-07","1991-02-03","1991-02-01","1990-12-28","1990-12-28","1990-12-07","1990-11-30","1990-11-08","1990-10-31","1990-10-12","1990-10-07","1990-10-04","1990-10-01","1990-09-29","1990-09-22","1990-09-20","1990-09-20","1990-09-16","1990-09-14","1990-06-17","1990-06-16","1990-06-09","1990-06-08","1990-06-07","1990-06-02","1990-05-31","1990-05-24","1990-05-23","1990-05-15","1990-05-13","1990-05-11","1990-05-10","1990-05-07","1990-05-06","1990-05-04","1990-04-21","1990-04-09","1990-04-07","1990-04-05","1990-03-28"],"duration":[17.2944,2.05888333333333,18.84735,4.3852,15.8948,1.1828,4.6812,22.2244,1.72713333333333,13.9776833333333,21.626,3.98976666666667,19.5766,2.37758333333333,6.2781,34.0144833333333,22.3712666666667,33.8425,9.7404,35.5557,2.44723333333333,1.53338333333333,3.29273333333333,3.30491666666667,9.6357,13.5532,11.4943166666667,13.0876,1.50945,13.2588833333333,0.93475,14.114,19.878,7.6032,15.4779833333333,20.2218166666667,18.6793,14.4524,11.6464,16.4401666666667,14.2167,19.52,15.8524166666667,12.1469333333333,16.6735166666667,13.0616666666667,16.7954333333333,16.95695,9.9496,12.0307,10.7811666666667,12.3820333333333,22.4478833333333,10.2051666666667,17.6052166666667,6.46356666666667,1.00963333333333,14.2955166666667,19.29535,26.0236166666667,8.4393,17.1263166666667,10.6853833333333,11.4986666666667,11.1216333333333,11.9627833333333,11.1682166666667,4.4652,0.943016666666667,0.975233333333333,8.92648333333333,0.688333333333333,7.59466666666667,16.0074,9.41801666666667,12.6441333333333,10.4851166666667,15.397,17.49115,23.77535,12.0494166666667,36.2797333333333,12.1695833333333,9.7192,12.5212,10.0423333333333,20.1560833333333,13.2279666666667,13.2932833333333,14.5772,14.79445,10.9701166666667,11.54655,11.5356666666667,12.6363,12.3546166666667,12.6506666666667,14.3521166666667,8.52201666666667,11.2439666666667,13.8592666666667,12.2409833333333,11.1081333333333,9.67183333333333,10.3518833333333,12.0664,13.3342,9.15113333333333,18.24305,16.4088166666667,13.6481166666667,10.8599666666667,12.9210333333333,10.3553666666667,10.4254666666667,6.24151666666667,12.4538833333333,13.1927,15.3491166666667,16.2991,13.2902333333333,16.5773,11.21045,11.1595166666667,12.5091666666667,15.0243333333333,14.82275,10.4324333333333,13.0046333333333,12.4199166666667,12.7412166666667,10.1342,17.1210833333333,13.5031333333333,12.8426666666667,8.64,5.68468333333333,15.2185,16.1998333333333,13.56,16.9469333333333,11.4904,11.0106166666667,22.1209333333333,12.93715,13.6820666666667,27.6958833333333,20.7825833333333,13.8666666666667,16.5420333333333,14.75745,15.7892833333333,11.53785,12.2679666666667,26.0275333333333,31.4414166666667,16.7601666666667,21.7299666666667,14.3103166666667,11.3615166666667,20.24185,15.0199666666667,15.2045666666667,15.2999166666667,21.1321833333333,12.6868,17.5190166666667,19.63755,20.4103333333333,14.5758833333333,12.4125166666667,17.4754833333333,16.3548333333333,16.6291166666667,16.08315,18.5216833333333,14.5902666666667,10.09545,15.4727666666667,19.3724,23.28685,16.6674333333333,12.4673666666667,15.9286,22.11875,18.3183666666667,11.6610666666667,17.8712333333333,18.6183333333333,18.7694166666667,10.816,10.7864,14.98035,20.1007833333333,11.56745,12.7111833333333,15.3252,17.1541833333333,13.9472166666667,17.2025,9.179,11.9340333333333,19.6619333333333,17.19075,12.59625,11.6567,10.3336,12.0798833333333,22.50145,19.8630666666667,9.29131666666667,9.69491666666667,26.2164833333333,15.04305,19.4007,21.56365,18.8273166666667,15.1057333333333,15.7178833333333,15.3173333333333,13.3185333333333,13.11085,30.80315,41.9073666666667,7.0953,10.8064166666667,50.2761333333333,22.67515,23.3108,26.10765,9.54818333333333,1.65746666666667,22.37605,44.0285166666667,20.0185,14.4322166666667,13.6241666666667,30.5058,12.2274833333333,11.04805,13.83445,16.27515,13.7639166666667,8.3052,2.331,1.13806666666667,12.8404833333333,18.6087666666667,10.9836166666667,12.1695833333333,13.68555,14.41785,15.5515666666667,15.2333,14.5628333333333,13.89715,11.33975,25.51685,13.5610333333333,13.4500166666667,11.5644,11.2918666666667,12.2592666666667,19.584,12.3345833333333,0.555966666666667,13.2693333333333,12.52615,12.54095,10.1464,9.23863333333333,11.3171166666667,19.7281166666667,16.8616,9.28958333333333,12.3589666666667,13.34335,11.89225,12.7290333333333,10.7633166666667,11.4255166666667,14.5166833333333,14.2802666666667,12.2867,11.904,11.6662833333333,11.9096666666667,11.1029166666667,13.8427166666667,11.4760333333333,12.05115,11.56615,11.1904166666667,1.76456666666667,4.57491666666667,12.3803,11.4068,9.7859,10.9997333333333,13.9742,12.1708833333333,13.5549333333333,14.2167,11.5004,12.4073,13.6041333333333,12.6633,9.06145,8.52506666666667,6.4283,18.6901833333333,10.7702833333333,10.916,11.0341166666667,12.4652,14.50145,12.544,12.4517,11.7516166666667,12.6419666666667,13.5262,10.6544833333333,11.1312166666667,10.9844833333333,10.94705,11.61055,11.2896833333333,10.6975833333333,11.2927333333333,13.2157833333333,9.83945,9.55951666666667,10.6078833333333,12.02025,11.18955,9.02181666666667,10.6679666666667,9.088,10.2613333333333,11.7302833333333,10.64055,9.7112,11.1434,10.8125166666667,10.2626333333333,11.51695,10.5247333333333,10.3327333333333,10.0349333333333,10.15815,9.79113333333333,10.4920833333333,9.83728333333333,10.2421833333333,10.9017666666667,11.5966333333333,11.17605,10.4729333333333,10.8795666666667,9.91738333333333,9.80593333333333,10.3061833333333,6.80141666666667,11.8260666666667,11.0611166666667,10.0702,11.0672166666667,10.5652166666667,6.28898333333333,4.97763333333333,11.18825,10.2178,10.5621833333333,10.71935,12.3419833333333,11.2509333333333,11.2949166666667,12.0655166666667,11.6919666666667,11.1965166666667,2.61006666666667,9.8116,10.0837,11.69415,9.96528333333333,8.7249,11.9170666666667,10.6666666666667,12.7312166666667,11.4925666666667,11.5422,11.29055,11.9963,12.02025,12.3650666666667,11.46515,10.5735,10.4859833333333,10.4968666666667,9.73148333333333,10.13115,12.7529833333333,9.4437,10.00055,8.59515]},"type":"data.frame","container":"svg","options":["background","#fadadd"],"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  tweezer.js */\n// d.duration to access the duration column\nconst yAccessor = d => d.duration\nconst dateParser = d3.timeParse(\"%Y-%m-%d\") \nconst xAccessor = d => dateParser(d.date)\n\nlet dimensions = {\n  // I dont think R2D3 liked detectecting the browser width\n  // so I changed to a static number\nwidth: 600, height: 400,\nmargin: {\n      top: 15,\n      right: 15,\n      bottom: 40,\n      left: 60,\n}, }\n\ndimensions.boundedWidth = dimensions.width\n    - dimensions.margin.left\n    - dimensions.margin.right\n    \ndimensions.boundedHeight = dimensions.height\n    - dimensions.margin.top\n    - dimensions.margin.bottom\n\n// const wrapper = d3.select(\"#wrapper\") \n// .append(\"svg\")\n// we don't need to select a div to put the \nconst wrapper = svg\n      .attr(\"width\", dimensions.width)\n      .attr(\"height\", dimensions.height)\n      .style(\"background\", \"#fadadd\")\n      \nconst bounds = wrapper.append(\"g\") .\n        style(\"transform\", `translate(${\n          dimensions.margin.left\n          }px, ${ dimensions.margin.top\n          }px)`)\n\nconst yScale = d3.scaleLinear() \n    .domain(d3.extent(data, yAccessor))\n    .range([dimensions.boundedHeight, 0])\n\n// const freezingTemperaturePlacement = yScale(32) \n// changing the name of this to meanSongPlacement\n// and placing the line at the mean duration\nconst meanSongPlacement = yScale(d3.mean(data, yAccessor))\n\n/*\nconst freezingTemperatures = bounds.append(\"rect\") \n      .attr(\"x\", 0)\n      .attr(\"width\", dimensions.boundedWidth)\n      .attr(\"y\", freezingTemperaturePlacement)\n      .attr(\"height\", dimensions.boundedHeight\n        - freezingTemperaturePlacement)\n      .attr(\"fill\", \"#e0f3f3\")\n*/\n\n//\nmeanSong = bounds.append(\"rect\")\n      .attr(\"x\", 0)\n      .attr(\"width\", dimensions.boundedWidth)\n      // we want the line to start 10 above the mean\n      .attr(\"y\", meanSongPlacement + 10)\n       // placeholder and end 10 below\n      .attr(\"height\", 20)\n      .attr(\"fill\", \"#e0f3f3\")\n\nconst xScale = d3.scaleTime() \n    .domain(d3.extent(data, xAccessor)) \n    .range([0, dimensions.boundedWidth])\n    \nconst lineGenerator = d3.line() \n    .x(d => xScale(xAccessor(d))) \n    .y(d => yScale(yAccessor(d)))\n    \nconst line = bounds.append(\"path\") \n     // change dataset to data\n    .attr(\"d\", lineGenerator(data)) \n    .attr(\"fill\", \"none\") \n    .attr(\"stroke\", \"#af9358\") \n    .attr(\"stroke-width\", 2)\n\nconst yAxisGenerator = d3.axisLeft().scale(yScale)\nconst yAxis = bounds.append(\"g\").call(yAxisGenerator)\n\nconst xAxisGenerator = d3.axisBottom().scale(xScale)\n\nconst xAxis = bounds.append(\"g\") \n      .call(xAxisGenerator)\n      //.style(\"transform\", `translateY(${ dimensions.boundedHeight} px)`)\n      // this is .style in the book\n      // but it looks like R2D3 doesn't allow for CSS transforms\n      .attr(\"transform\", `translate(0, ${dimensions.boundedHeight})`)\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="twitter">
<p>It looks like we can use the <code>elementId</code> argument in <code>r2d3</code> to render our graphic to a specific div - I assume this is the same as declairing <code>&lt;div id="wrapper"&gt;&lt;/div&gt;</code> in the book!</p>
</div>
<p>And that’s it! I think a great workflow for creating these viz in the future will be making the plots in <code>Observable</code>, then making these small tweaks so I can use real data in R.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>